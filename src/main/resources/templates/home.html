<!DOCTYPE html>
<html lang="fr"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout}">
<head>
    <title>Accueil</title>
</head>
<body>
<main layout:fragment="content">
    <div class="container">
        <!-- Titre avec salutation dynamique -->
        <h1 th:text="${greeting} + ' et bienvenue sur MinecraftQuest'">
            üè† Bienvenue sur MinecraftQuest
        </h1>

        <!-- Alerte si non connect√© -->
        <div th:if="${currentUser == null}" class="alert alert-info">
            <p>
                Pour profiter de toutes les fonctionnalit√©s,
                <a th:href="@{/login}">connectez-vous</a>
                ou
                <a th:href="@{/register}">inscrivez-vous</a>.
            </p>
        </div>

        <!-- Stats utilisateur si connect√© -->
        <div th:if="${currentUser != null}">
            <p th:text="${greeting} + ' ' + ${currentUser.username} + ' !'">Salut Joueur !</p>
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value" th:text="${userStats.level}">1</div>
                    <div class="stat-label">Niveau</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" th:text="${userStats.xp}">0</div>
                    <div class="stat-label">XP Total</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" th:text="${userStats.completedQuests}">0</div>
                    <div class="stat-label">Qu√™tes Compl√©t√©es</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" th:text="${userStats.activeChallenges}">0</div>
                    <div class="stat-label">D√©fis Actifs</div>
                </div>
            </div>
        </div>

        <!-- Actions rapides -->
        <div class="container">
            <h2>üöÄ Actions rapides</h2>
            <div class="grid grid-3">
                <div class="card">
                    <div class="card-header"><h3><i class="fas fa-scroll"></i> Qu√™tes</h3></div>
                    <div class="card-content"><p>D√©couvrez les qu√™tes disponibles.</p></div>
                    <div class="card-footer"><a th:href="@{/quests}" class="btn">Voir les qu√™tes</a></div>
                </div>
                <div class="card">
                    <div class="card-header"><h3><i class="fas fa-plus"></i> Cr√©er une qu√™te</h3></div>
                    <div class="card-content"><p>Cr√©ez votre propre aventure.</p></div>
                    <div class="card-footer"><a th:href="@{/quests/create}" class="btn">Cr√©er maintenant</a></div>
                </div>
                <div class="card">
                    <div class="card-header"><h3><i class="fas fa-trophy"></i> D√©fis</h3></div>
                    <div class="card-content"><p>Lancez ou acceptez des d√©fis.</p></div>
                    <div class="card-footer"><a th:href="@{/challenges}" class="btn">Voir les d√©fis</a></div>
                </div>
            </div>
        </div>

        <!-- Qu√™tes r√©centes -->
        <section th:if="${recentQuests != null and !recentQuests.isEmpty()}">
            <h2>üìã Qu√™tes r√©centes</h2>
            <div class="grid grid-2">
                <div th:each="q : ${recentQuests}" class="card">
                    <div class="card-header">
                        <h3 th:text="${q.title}">Titre</h3>
                        <p>Par <strong th:text="${q.author.username}">Auteur</strong></p>
                    </div>
                    <div class="card-content">
                        <p th:text="${#strings.abbreviate(q.description, 100)}">Desc‚Ä¶</p>
                    </div>
                    <div class="card-footer">
                        <span class="badge badge-primary">
                            <i class="fas fa-star"></i>
                            <span th:text="${q.xpReward}">0</span> XP
                        </span>
                        <a th:href="@{/quests/{id}(id=${q.id})}" class="btn btn-small">Voir</a>
                    </div>
                </div>
            </div>
        </section>
        <div th:if="${recentQuests == null or recentQuests.isEmpty()}" class="empty-state">
            <p>Pas de qu√™tes r√©centes pour le moment.</p>
        </div>

        <!-- D√©fis actifs si connect√© -->
        <section th:if="${activeChallengesList != null and !activeChallengesList.isEmpty()}">
            <h2>‚öîÔ∏è Tes d√©fis actifs</h2>
            <div class="grid grid-2">
                <div th:each="c : ${activeChallengesList}" class="card">
                    <div class="card-header">
                        <h3 th:text="${c.quest.title}">D√©fi</h3>
                        <span class="badge badge-warning">En cours</span>
                    </div>
                    <div class="card-content">
                        <p th:text="${#strings.abbreviate(c.quest.description, 100)}">Desc‚Ä¶</p>
                        <small>Expire le
                            <span th:text="${#temporals.format(c.expirationDate,'dd/MM/yyyy HH:mm')}">date</span>
                        </small>
                    </div>
                    <div class="card-footer">
                        <a th:href="@{/challenges/{id}(id=${c.id})}" class="btn btn-small">Voir d√©fi</a>
                    </div>
                </div>
            </div>
        </section>
        <div th:if="${activeChallengesList == null or activeChallengesList.isEmpty()}" class="empty-state">
            <p>Vous n‚Äôavez pas de d√©fis en cours.</p>
        </div>

        <!-- TOP 5 JOUEURS EN MODE TABLEAU, style identique √† leaderboard.html -->
        <section>
            <h2>üèÜ Classement - Top 5 joueurs</h2>

            <!-- Si pas de joueurs -->
            <div th:if="${topUsers == null or #lists.isEmpty(topUsers)}" class="empty-state">
                <i class="fas fa-user-friends"></i>
                <p>Aucun joueur √† afficher.</p>
            </div>

            <!-- Sinon on affiche jusqu'√† 5 joueurs -->
            <table th:if="${topUsers != null and !#lists.isEmpty(topUsers)}" class="table">
                <thead>
                <tr>
                    <th>Rang</th>
                    <th>Joueur</th>
                    <th>XP</th>
                    <th>Niveau</th>
                </tr>
                </thead>
                <tbody id="leaderboardBody">
                <!-- Joue jusqu‚Äôau 5 premiers, m√™me si la liste est plus longue -->
                <tr th:each="u, iterStat : ${topUsers}" th:if="${iterStat.count <= 5}">
                    <td th:text="${iterStat.count}">1</td>
                    <td th:text="${u.username}">Pseudo</td>
                    <td th:text="${u.xp}">0</td>
                    <td th:text="${u.level}">1</td>
                </tr>
                <!-- Lignes ‚ÄúDisponibles‚Äù si moins de 5 joueurs -->
                <tr th:if="${topUsers.size() < 5}"
                    th:each="i : ${#numbers.sequence(topUsers.size()+1,5)}">
                    <td th:text="${i}">n</td>
                    <td class="empty-state">Disponible</td>
                    <td class="empty-state">‚Äì</td>
                    <td class="empty-state">‚Äì</td>
                </tr>
                </tbody>
            </table>
        </section>


    </div>
</main>
</body>
</html>

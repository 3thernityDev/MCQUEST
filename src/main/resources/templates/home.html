<!DOCTYPE html>
<html lang="fr"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout}">
<head>
    <title>Accueil</title>
</head>
<body>
<main layout:fragment="content">
    <div class="container">
        <!-- Titre avec salutation dynamique -->
        <h1 th:text="${greeting} + ' et bienvenue sur MinecraftQuest'">
            üè† Bienvenue sur MinecraftQuest
        </h1>

        <!-- Alerte si non connect√© -->
        <div th:if="${currentUser == null}" class="alert alert-info">
            <p>
                Pour profiter de toutes les fonctionnalit√©s,
                <a th:href="@{/login}">connectez-vous</a>
                ou
                <a th:href="@{/register}">inscrivez-vous</a>.
            </p>
        </div>

        <!-- Stats utilisateur si connect√© -->
        <div th:if="${currentUser != null}">
            <p th:text="${greeting} + ' ' + ${currentUser.username} + ' !'">Salut Joueur !</p>
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value" th:text="${userStats.level}">1</div>
                    <div class="stat-label">Niveau</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" th:text="${userStats.xp}">0</div>
                    <div class="stat-label">XP Total</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" th:text="${userStats.completedQuests}">0</div>
                    <div class="stat-label">Qu√™tes Compl√©t√©es</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" th:text="${userStats.activeChallenges}">0</div>
                    <div class="stat-label">D√©fis Actifs</div>
                </div>
            </div>
        </div>

        <!-- Actions rapides -->
        <div class="container">
            <h2>üöÄ Actions rapides</h2>
            <div class="grid grid-3">
                <div class="card">
                    <div class="card-header"><h3><i class="fas fa-scroll"></i> Qu√™tes</h3></div>
                    <div class="card-content"><p>D√©couvrez les qu√™tes disponibles.</p></div>
                    <div class="card-footer"><a th:href="@{/quests}" class="btn">Voir les qu√™tes</a></div>
                </div>
                <div class="card">
                    <div class="card-header"><h3><i class="fas fa-plus"></i> Cr√©er une qu√™te</h3></div>
                    <div class="card-content"><p>Cr√©ez votre propre aventure.</p></div>
                    <div class="card-footer"><a th:href="@{/quests/create}" class="btn">Cr√©er maintenant</a></div>
                </div>
                <div class="card">
                    <div class="card-header"><h3><i class="fas fa-trophy"></i> D√©fis</h3></div>
                    <div class="card-content"><p>Lancez ou acceptez des d√©fis.</p></div>
                    <div class="card-footer"><a th:href="@{/challenges}" class="btn">Voir les d√©fis</a></div>
                </div>
            </div>
        </div>

        <!-- Qu√™tes r√©centes -->
        <section th:if="${recentQuests != null and !recentQuests.isEmpty()}">
            <h2>üìã Qu√™tes r√©centes</h2>
            <div class="grid grid-2">
                <div th:each="q : ${recentQuests}" class="card">
                    <div class="card-header">
                        <h3 th:text="${q.title}">Titre</h3>
                        <p>Par <strong th:text="${q.author.username}">Auteur</strong></p>
                    </div>
                    <div class="card-content">
                        <p th:text="${#strings.abbreviate(q.description, 100)}">Desc‚Ä¶</p>
                    </div>
                    <div class="card-footer">
                        <span class="badge badge-primary">
                            <i class="fas fa-star"></i>
                            <span th:text="${q.xpReward}">0</span> XP
                        </span>
                        <a th:href="@{/quests/{id}(id=${q.id})}" class="btn btn-small">Voir</a>
                    </div>
                </div>
            </div>
        </section>
        <div th:if="${recentQuests == null or recentQuests.isEmpty()}" class="empty-state">
            <p>Pas de qu√™tes r√©centes pour le moment.</p>
        </div>

        <!-- D√©fis actifs si connect√© -->
        <section th:if="${activeChallengesList != null and !activeChallengesList.isEmpty()}">
            <h2>‚öîÔ∏è Tes d√©fis actifs</h2>
            <div class="grid grid-2">
                <div th:each="c : ${activeChallengesList}" class="card">
                    <div class="card-header">
                        <h3 th:text="${c.quest.title}">D√©fi</h3>
                        <span class="badge badge-warning">En cours</span>
                    </div>
                    <div class="card-content">
                        <p th:text="${#strings.abbreviate(c.quest.description, 100)}">Desc‚Ä¶</p>
                        <small>Expire le
                            <span th:text="${#temporals.format(c.expirationDate,'dd/MM/yyyy HH:mm')}">date</span>
                        </small>
                    </div>
                    <div class="card-footer">
                        <a th:href="@{/challenges/{id}(id=${c.id})}" class="btn btn-small">Voir d√©fi</a>
                    </div>
                </div>
            </div>
        </section>
        <div th:if="${activeChallengesList == null or activeChallengesList.isEmpty()}" class="empty-state">
            <p>Vous n‚Äôavez pas de d√©fis en cours.</p>
        </div>

        <!-- TOP 5 JOUEURS EN MODE PODIUM -->
        <section>
            <h2>üèÖ Top 5 joueurs</h2>
            <div class="podium">
                <div th:each="idx : ${#numbers.sequence(0,4)}"
                     class="podium__item"
                     th:classappend="' podium__item--' + (idx + 1)">
                    <div class="podium__rank" th:text="${idx + 1}">1</div>

                    <!-- Utilisateur existant -->
                    <div th:if="${topUsers != null and topUsers.size() > idx}">
                        <div class="podium__name" th:text="${topUsers[idx].username}">Pseudo</div>
                        <div class="podium__stats"
                             th:text="'Niv ' + ${topUsers[idx].level} + ' ‚Ä¢ ' + ${topUsers[idx].xp} + ' XP'">
                        </div>
                    </div>

                    <!-- Place libre -->
                    <div th:unless="${topUsers != null and topUsers.size() > idx}" class="podium__placeholder">
                        <div class="podium__name">Disponible</div>
                        <div class="podium__stats">En attente</div>
                    </div>
                </div>
            </div>
        </section>

    </div>
</main>
</body>
</html>
